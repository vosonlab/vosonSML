#' @title Create an igraph graph from network
#'
#' @param net A named list of dataframes \code{nodes} and \code{edges} generated by \code{Create}.
#' @param directed Logical. Create a directed graph. Default is \code{TRUE}.
#' @param writeToFile Logical. Save graph to a file in the current working directory. Default is \code{FALSE}.
#' @param ... Additional parameters passed to function. Not used in this method.
#'
#' @return An igraph object.
#'
#' @aliases Graph
#' @name Graph
#' @export
Graph <- function(net,
                  directed = TRUE,
                  writeToFile = FALSE,
                  ...) {

  rlang::check_installed("igraph", "for Graph")
  stop_req_pkgs(c("igraph"), "Graph")

  cat("Creating igraph network graph...")
  if (writeToFile) {
    cat("\n")
  }

  # igraph warning converting a dataframe with an POSIXct column to an igraph object
  # https://github.com/igraph/rigraph/pull/250
  # https://github.com/igraph/rigraph/issues/251
  if (is.data.frame(net$nodes) & is.data.frame(net$edges)) {
    net$nodes %<>% dplyr::mutate_if(lubridate::is.POSIXt, as.character)
    net$edges %<>% dplyr::mutate_if(lubridate::is.POSIXt, as.character)
  }

  if (any(c("twitter", "youtube", "reddit", "web") %in% class(net)) &
      any(c("activity", "actor", "twomode") %in% class(net))) {
    g <-
      igraph::graph_from_data_frame(d = net$edges,
                                    directed = directed,
                                    vertices = net$nodes)
  }

  # if (!all(c("semantic", "twitter") %in% class(net))) {
  #   # create igraph object from dataframes
  #   g <-
  #     igraph::graph_from_data_frame(d = net$edges,
  #                                   directed = directed,
  #                                   vertices = net$nodes)
  # }

  # searches the class list of net for matching method
  UseMethod("Graph", net)
}

#' @noRd
#' @export
Graph.default <- function(...) {
  stop("Unknown network type passed to graph.", call. = FALSE)
}

#' @noRd
#' @method Graph activity
#' @export
Graph.activity <-
  function(net,
           directed = TRUE,
           writeToFile = FALSE,
           ...) {
    UseMethod("Graph.activity", net)
  }

#' @noRd
#' @export
Graph.activity.default <- function(...) {
  stop("Unknown social media type passed to graph.", call. = FALSE)
}

#' @noRd
#' @export
Graph.activity.twitter <-
  function(net,
           directed = TRUE,
           writeToFile = FALSE,
           ...) {
    # igraph::V(g)$label <- paste0(igraph::V(g)$screen_name)
    # igraph::V(g)$label <-
    #   ifelse(
    #     !is.na(igraph::V(g)$screen_name),
    #     paste0(igraph::V(g)$name, " (", igraph::V(g)$screen_name, ")"),
    #     igraph::V(g)$name
    #   )
    g <- igraph::set_graph_attr(g, "type", "twitter")

    graphOutputFile(g, "graphml", writeToFile, "TwitterActivity")
    cat("Done.\n")

    g
  }

#' @noRd
#' @export
Graph.activity.youtube <-
  function(net,
           directed = TRUE,
           writeToFile = FALSE,
           ...) {
    # igraph::V(g)$label <- ifelse(
    #   !is.na(igraph::V(g)$screen_name),
    #   paste0(igraph::V(g)$name, " (", igraph::V(g)$screen_name, ")"),
    #   igraph::V(g)$name
    # )
    g <- igraph::set_graph_attr(g, "type", "youtube")

    graphOutputFile(g, "graphml", writeToFile, "YoutubeActivity")
    cat("Done.\n")

    g
  }

#' @noRd
#' @export
Graph.activity.reddit <-
  function(net,
           directed = TRUE,
           writeToFile = FALSE,
           ...) {
    # V(g)$label <- ifelse(!is.na(V(g)$user), paste0(V(g)$name, " (", V(g)$user, ")"), V(g)$name)
    # igraph::V(g)$label <- paste0(igraph::V(g)$thread_id,
    #                              ifelse(
    #                                !is.na(igraph::V(g)$comm_id),
    #                                paste0(".", igraph::V(g)$comm_id),
    #                                ""
    #                              ),
    #                              ifelse(
    #                                !is.na(igraph::V(g)$user),
    #                                paste0(" (", igraph::V(g)$user, ")"),
    #                                ""
    #                              ))

    g <- igraph::set_graph_attr(g, "type", "reddit")

    graphOutputFile(g, "graphml", writeToFile, "RedditActivity")
    cat("Done.\n")

    g
  }

#' @noRd
#' @export
Graph.activity.web <-
  function(net,
           directed = TRUE,
           writeToFile = FALSE,
           ...) {
    # igraph::V(g)$label <- igraph::V(g)$name

    g <- igraph::set_graph_attr(g, "type", "web")

    graphOutputFile(g, "graphml", writeToFile, "WebActivity")
    cat("Done.\n")

    g
  }

#' @noRd
#' @method Graph actor
#' @export
Graph.actor <-
  function(net,
           directed = TRUE,
           writeToFile = FALSE,
           ...) {
    UseMethod("Graph.actor", net)
  }

#' @noRd
#' @export
Graph.actor.default <- function(...) {
  stop("Unknown social media type passed to graph.", call. = FALSE)
}

#' @noRd
#' @export
Graph.actor.twitter <-
  function(net,
           directed = TRUE,
           writeToFile = FALSE,
           ...) {
    # igraph::V(g)$label <-
    #   ifelse(
    #     is.na(igraph::V(g)$screen_name),
    #     paste0("ID:", igraph::V(g)$name),
    #     paste0(igraph::V(g)$screen_name, " (", igraph::V(g)$name, ")")
    #   )
    g <- igraph::set_graph_attr(g, "type", "twitter")

    graphOutputFile(g, "graphml", writeToFile, "TwitterActor")
    cat("Done.\n")

    g
  }

#' @noRd
#' @export
Graph.actor.youtube <-
  function(net,
           directed = TRUE,
           writeToFile = FALSE,
           ...) {
    # igraph::V(g)$label <-
    #   ifelse(
    #     is.na(igraph::V(g)$screen_name),
    #     igraph::V(g)$name,
    #     paste0(igraph::V(g)$screen_name, " (", igraph::V(g)$name, ")")
    #   )
    g <- igraph::set_graph_attr(g, "type", "youtube")

    graphOutputFile(g, "graphml", writeToFile, "YoutubeActor")
    cat("Done.\n")

    g
  }

#' @noRd
#' @export
Graph.actor.reddit <-
  function(net,
           directed = TRUE,
           writeToFile = FALSE,
           ...) {
    # igraph::V(g)$label <-
    #   ifelse(
    #     is.na(igraph::V(g)$user),
    #     paste0("ID:", igraph::V(g)$name),
    #     paste0(igraph::V(g)$user, " (", igraph::V(g)$name, ")")
    #   )

    g <- igraph::set_graph_attr(g, "type", "reddit")

    graphOutputFile(g, "graphml", writeToFile, "RedditActor")
    cat("Done.\n")

    g
  }

#' @noRd
#' @export
Graph.actor.web <-
  function(net,
           directed = TRUE,
           writeToFile = FALSE,
           ...) {
    # igraph::V(g)$label <- igraph::V(g)$name

    g <- igraph::set_graph_attr(g, "type", "web")

    graphOutputFile(g, "graphml", writeToFile, "WebActor")
    cat("Done.\n")

    g
  }

#' @noRd
#' @method Graph semantic
#' @export
Graph.semantic <-
  function(net,
           directed = FALSE,
           writeToFile = FALSE,
           ...) {
    UseMethod("Graph.semantic", net)
  }

#' @noRd
#' @export
Graph.semantic.default <- function(...) {
  stop("Unknown social media type passed to graph.", call. = FALSE)
}

#' @noRd
#' @export
Graph.semantic.twitter <-
  function(net,
           directed = FALSE,
           writeToFile = FALSE,
           ...) {
    # create igraph object from dataframes
    g <-
      igraph::graph_from_data_frame(d = net$edges,
                                    directed = directed,
                                    vertices = net$nodes)

    # igraph::V(g)$label <- igraph::V(g)$name
    g <- igraph::set_graph_attr(g, "type", "twitter")

    graphOutputFile(g, "graphml", writeToFile, "TwitterSemantic")
    cat("Done.\n")

    g
  }

#' @noRd
#' @method Graph twomode
#' @export
Graph.twomode <-
  function(net,
           directed = TRUE,
           writeToFile = FALSE,
           ...) {
    UseMethod("Graph.twomode", net)
  }

#' @noRd
#' @export
Graph.twomode.default <- function(...) {
  stop("Unknown social media type passed to graph.", call. = FALSE)
}

#' @noRd
#' @export
Graph.twomode.twitter <-
  function(net,
           directed = TRUE,
           writeToFile = FALSE,
           ...) {
    # igraph::V(g)$label <- ifelse(is.na(igraph::V(g)$user_id), igraph::V(g)$name, paste0(igraph::V(g)$name, " (", igraph::V(g)$user_id, ")"))
    # igraph::V(g)$label <- igraph::V(g)$name

    g <- igraph::set_graph_attr(g, "type", "twitter")

    graphOutputFile(g, "graphml", writeToFile, "Twitter2mode")
    cat("Done.\n")

    g
  }

# set output file name
# if wtof is logical use def as file name
# if character use wtof as file name
graphOutputFile <- function(g, type, wtof, def) {
  if (is.logical(wtof) && wtof) {
    write_output_file(g, "graphml", def)
  } else if (is.character(wtof)) {
    write_output_file(g, "graphml", wtof)
  }
}
